<div class="modal-header anexo bg-danger text-white">
   <h4 class="modal-title">{{ this.codigoProcedimientoTupa}} {{ this.descProcedimientoTupa}}</h4>
   <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="activeModal.close(graboUsuario)">

   </button>
</div>
<div class="modal-body anexo">
   <div class="container mt-2 mb-3">
      <form [formGroup]='anexoFG'>
         <div class="center">
            <h5>ANEXO 002-A17.2 &nbsp;&nbsp; TRANSPORTE INTERNACIONAL TERRESTRE CONO SUR - ATIT</h5>
         </div>
         <div ngbAccordion #acc="ngbAccordion" activeIds="seccion-3">
            <div [disabled]="a_Seccion1FG.disabled" ngbAccordionItem="seccion-1">
               <h2 ngbAccordionHeader>

                  <button ngbAccordionButton>I. COMPLETAR
                     SEGÚN REQUISITOS DEL PROCEDIMIENTO: DSTT-006, DSTT-007, DSTT-010, DSTT-012, DSTT-013</button>
               </h2>
               <div ngbAccordionCollapse>
                  <div ngbAccordionBody>
                     <ng-template>
                        <div formGroupName="a_Seccion1FG">
                           <!--si es DSTT-007, DSTT-009, DSTT-013-->
                           <div class="row">
                              <div class="col-lg-12 d-flex" formArrayName="a_s1_PaisesOperarFA">

                                 <div class="campo-obligatorio d-flex align-self-center">
                                    Países con los que se pretende operar:
                                 </div>

                                 <div class="flex-1">
                                    <div class="contenedor-check-paises"
                                       [class.control-invalid]="formInvalid(a_s1_PaisesOperarFA)">
                                       <div *ngFor="let item of a_s1_PaisesOperarFA.controls; let i=index">
                                          <div [formGroupName]="i">
                                             <div class="form-check form-check-inline">
                                                <input class="form-check-input" id="inpCheckPO{{ i }}" type="checkbox"
                                                   formControlName="checked">
                                                <label class="form-check-label" for="inpCheckPO{{ i }}">{{
                                                   item.get('text').value }}</label>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                    <div
                                       *ngIf="a_s1_PaisesOperarFA.invalid && (a_s1_PaisesOperarFA.dirty || a_s1_PaisesOperarFA.touched)"
                                       class="text-danger ms-4">
                                       <div *ngIf="a_s1_PaisesOperarFA.errors?.errorChecked">
                                          El campo es obligatorio
                                       </div>
                                    </div>
                                 </div>

                                 <!-- <div class="contenedor-check-paises justify-content-between"
                                        [class.control-invalid]="formInvalid(a_s1_PaisesOperarFA)">
                                        <label class="check"
                                            *ngFor="let item of a_s1_PaisesOperarFA.controls; let i = index">
                                            <input type="checkbox" [formControl]="item.get('checked')" /> {{
                                            item.get('text').value }}
                                        </label>
                                    </div> -->
                              </div>
                           </div>
                           <!--fin DSTT-007, DSTT-009, DSTT-013-->

                           <!--si es DSTT-007, DSTT-009-->
                           <div *ngIf="a_s1_TransIntFG.enabled">
                              <div formGroupName="a_s1_TransIntFG">
                                 <div class="row mt-3">
                                    <div class="col-lg-5 d-flex flex-column">
                                       <div class="d-flex align-items-center">
                                          <div class="campo-obligatorio flex-1">Origen:</div>
                                          <div class="flex-1">
                                             <span class="form-control" disabled>Perú</span>
                                          </div>
                                       </div>
                                       <div class="d-flex align-items-center mt-3">
                                          <div class="campo-obligatorio flex-1">Destino:</div>
                                          <div class="flex-1">
                                             <select class="form-select" formControlName="a_s1_ti_DestinoFC"
                                                [class.control-invalid]="formInvalid(a_s1_ti_DestinoFC)">
                                                <option value="">Seleccione</option>
                                                <option *ngFor="let item of listaPaises" [value]="item.value">{{
                                                   item.text
                                                   }}</option>
                                             </select>
                                             <div
                                                *ngIf="a_s1_ti_DestinoFC.invalid && (a_s1_ti_DestinoFC.dirty || a_s1_ti_DestinoFC.touched)"
                                                class="text-danger">
                                                <div *ngIf="a_s1_ti_DestinoFC.errors?.required">
                                                   El campo es obligatorio
                                                </div>
                                             </div>
                                          </div>
                                       </div>

                                       <div class="d-flex align-items-center mt-3">
                                          <div class="campo-obligatorio flex-1">
                                             Ciudades a Operar:
                                          </div>
                                          <div class="flex-1">
                                             <input type="text" class="form-control text-uppercase"
                                                formControlName="a_s1_ti_CiudadesOperarFC"
                                                [class.control-invalid]="formInvalid(a_s1_ti_CiudadesOperarFC)"
                                                maxlength="50" />
                                             <div
                                                *ngIf="a_s1_ti_CiudadesOperarFC.invalid && (a_s1_ti_CiudadesOperarFC.dirty || a_s1_ti_CiudadesOperarFC.touched)"
                                                class="text-danger">
                                                <div *ngIf="a_s1_ti_CiudadesOperarFC.errors?.required">
                                                   El campo es obligatorio
                                                </div>
                                                <div *ngIf="a_s1_ti_CiudadesOperarFC.errors?.maxlength">
                                                   El tamaño máximo permitido es {{
                                                   inputFormControl.errors.maxlength.requiredLength }}
                                                   caracteres
                                                </div>
                                                <div *ngIf="a_s1_ti_CiudadesOperarFC.errors?.whitespace">
                                                   El campo no debe contener espacios en blanco al inicio ni al
                                                   final
                                                </div>
                                             </div>
                                          </div>
                                       </div>

                                    </div>

                                    <div class="col-lg-7">
                                       <div class="d-flex align-items-center">
                                          <div class="flex-1 campo-obligatorio">Número de frecuencias:</div>
                                          <div class="d-flex flex-1">
                                             <div class="flex-1 me-1">
                                                <select class="form-select" (change)="changeNumeroFrecuencia($event)"
                                                   formControlName="a_s1_ti_FrecuenciaFC"
                                                   [class.control-invalid]="formInvalid(a_s1_ti_FrecuenciaFC)">
                                                   <option value="">Seleccione</option>
                                                   <option value="Diario">Diario</option>
                                                   <option value="Semanal">Semanal</option>
                                                   <option value="Mensual">Mensual</option>
                                                </select>
                                                <div
                                                   *ngIf="a_s1_ti_FrecuenciaFC.invalid && (a_s1_ti_FrecuenciaFC.dirty || a_s1_ti_FrecuenciaFC.touched)"
                                                   class="text-danger">
                                                   <div *ngIf="a_s1_ti_FrecuenciaFC.errors?.required">
                                                      El campo es obligatorio
                                                   </div>
                                                </div>
                                             </div>
                                             <div class="flex-1 ms-1">
                                                <input type="text" class="form-control text-center" #inputFrecuencia
                                                   maxlength="2" (input)="soloNumeros($event)"
                                                   formControlName="a_s1_ti_NumeroFrecuenciaFC"
                                                   [class.control-invalid]="formInvalid(a_s1_ti_NumeroFrecuenciaFC)">
                                                <div
                                                   *ngIf="a_s1_ti_NumeroFrecuenciaFC.invalid && (a_s1_ti_NumeroFrecuenciaFC.dirty || a_s1_ti_NumeroFrecuenciaFC.touched)"
                                                   class="text-danger">
                                                   <div *ngIf="a_s1_ti_NumeroFrecuenciaFC.errors?.required">
                                                      El campo es obligatorio
                                                   </div>
                                                   <div *ngIf="a_s1_ti_NumeroFrecuenciaFC.errors?.maxlength">
                                                      El tamaño máximo permitido es {{
                                                      inputFormControl.errors.maxlength.requiredLength }}
                                                      caracteres
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>

                                       <div class="d-flex align-items-center mt-3">
                                          <div class="flex-1 campo-obligatorio">Horarios de salida:</div>
                                          <div class="flex-1">
                                             <input type="text" class="form-control text-uppercase"
                                                formControlName="a_s1_ti_HorarioSalidaFC"
                                                [class.control-invalid]="formInvalid(a_s1_ti_HorarioSalidaFC)"
                                                maxlength="50" />
                                             <div
                                                *ngIf="a_s1_ti_HorarioSalidaFC.invalid && (a_s1_ti_HorarioSalidaFC.dirty || a_s1_ti_HorarioSalidaFC.touched)"
                                                class="text-danger">
                                                <div *ngIf="a_s1_ti_HorarioSalidaFC.errors?.required">
                                                   El campo es obligatorio
                                                </div>
                                                <div *ngIf="a_s1_ti_HorarioSalidaFC.errors?.maxlength">
                                                   El tamaño máximo permitido es {{
                                                   inputFormControl.errors.maxlength.requiredLength }}
                                                   caracteres
                                                </div>
                                                <div *ngIf="a_s1_ti_HorarioSalidaFC.errors?.whitespace">
                                                   El campo no debe contener espacios en blanco al inicio ni al
                                                   final
                                                </div>
                                             </div>
                                          </div>
                                       </div>

                                       <div class="d-flex align-items-center mt-3">
                                          <div class="flex-1 campo-obligatorio">Tiempo promedio de viaje:</div>
                                          <div class="flex-1">
                                             <div class="d-flex align-items-center">
                                                <input type="text" class="form-control w-25 text-center me-2"
                                                   maxlength="2" (input)="soloNumeros($event)"
                                                   formControlName="a_s1_ti_TiempoPromedioViajeFC"
                                                   [class.control-invalid]="formInvalid(a_s1_ti_TiempoPromedioViajeFC)">
                                                hrs
                                             </div>
                                             <div
                                                *ngIf="a_s1_ti_TiempoPromedioViajeFC.invalid && (a_s1_ti_TiempoPromedioViajeFC.dirty || a_s1_ti_TiempoPromedioViajeFC.touched)"
                                                class="text-danger ms-auto">
                                                <div *ngIf="a_s1_ti_TiempoPromedioViajeFC.errors?.required">
                                                   El campo es obligatorio
                                                </div>
                                                <div *ngIf="a_s1_ti_TiempoPromedioViajeFC.errors?.maxlength">
                                                   El tamaño máximo permitido es {{
                                                   inputFormControl.errors.maxlength.requiredLength }}
                                                   caracteres
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                 </div>
                                 <div class="row mt-3">
                                    <div class="col-lg-12">
                                       <div class="d-flex" formArrayName="a_s1_ti_PaisesTransitoFA">
                                          <div class="campo-obligatorio d-flex align-self-center">Países a operar:
                                          </div>

                                          <div class="flex-1">
                                             <div class="contenedor-check-paises"
                                                [class.control-invalid]="formInvalid(a_s1_ti_PaisesTransitoFA)">
                                                <div
                                                   *ngFor="let item of a_s1_ti_PaisesTransitoFA.controls; let i=index">
                                                   <div [formGroupName]="i">
                                                      <div class="form-check form-check-inline">
                                                         <input class="form-check-input" id="inpCheckPT{{ i }}"
                                                            type="checkbox" formControlName="checked">
                                                         <label class="form-check-label" for="inpCheckPT{{ i }}">{{
                                                            item.get('text').value
                                                            }}</label>
                                                      </div>
                                                   </div>
                                                </div>
                                             </div>
                                             <div
                                                *ngIf="a_s1_ti_PaisesTransitoFA.invalid && (a_s1_ti_PaisesTransitoFA.dirty || a_s1_ti_PaisesTransitoFA.touched)"
                                                class="text-danger ms-4">
                                                <div *ngIf="a_s1_ti_PaisesTransitoFA.errors?.errorChecked">
                                                   El campo es obligatorio
                                                </div>
                                             </div>
                                          </div>


                                          <!-- <div class="contenedor-check-paises mt-3 justify-content-between"
                                                [class.control-invalid]="formInvalid(a_s1_ti_PaisesTransitoFA)">
                                                <label class="check"
                                                    *ngFor="let item of a_s1_ti_PaisesTransitoFA.controls; let i = index">
                                                    <input type="checkbox" [formControl]="item.get('checked')" /> {{
                                                    item.get('text').value }}
                                                </label>
                                            </div> -->
                                       </div>
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <!--fin DSTT-007, DSTT-009-->
                        </div>
                     </ng-template>
                  </div>
               </div>
            </div>
            <div [disabled]="a_Seccion2FG.disabled" ngbAccordionItem="seccion-2">
               <h2 ngbAccordionHeader>

                  <button ngbAccordionButton>II. MARCAR PARA
                     EL PROCEDIMIENTO: DSTT-014</button>
               </h2>
               <div ngbAccordionCollapse>
                  <div ngbAccordionBody>
                     <ng-template>
                        <div formGroupName="a_Seccion2FG">
                           <!--si es DSTT-014-->
                           <div class="row">
                              <div class="col-lg-12">
                                 <label class="control-label textoellipsis">Seleccione el procedimiento que
                                    corresponda</label>
                              </div>
                           </div>
                           <div class="row">
                              <div class="col-lg-4"></div>
                              <div class="col-lg-4 d-flex justify-content-between">
                                 <label>
                                    <input type="radio" value="1" formControlName="a_s2_FlotaFC"
                                       (change)="changeTipo('2')" /> ALTA
                                 </label>
                                 <label>
                                    <input type="radio" value="2" formControlName="a_s2_FlotaFC"
                                       (change)="changeTipo('1')" /> BAJA
                                 </label>
                              </div>
                              <div class="col-lg-4"></div>
                           </div>
                           <!--fin DSTT-014-->
                        </div>
                     </ng-template>
                  </div>
               </div>
            </div>
            <div ngbAccordionItem="seccion-3" [collapsed]="false">
               <h2 ngbAccordionHeader>

                  <button ngbAccordionButton>III. REGISTRAR LA
                     FLOTA VEHICULAR PARA EL PROCEDIMIENTO</button>
               </h2>
               <div ngbAccordionCollapse>
                  <div ngbAccordionBody>
                     <ng-template>
                        <div formGroupName="a_Seccion3FG">
                           <div class="row">
                              <div class="col-lg-12">
                                 Relación de vehículos ofertados que cuenten con CITV y SOAT vigentes, de su
                                 propiedad o
                                 en los casos que corresponda Leasing marcar con un aspa (X):
                              </div>
                           </div>

                           <div class="row mt-3">
                              <div class="col-lg-5 flex-2 d-flex flex-column">
                                 <div class="d-flex align-items-center flex-1">
                                    <div class="flex-1 campo-obligatorio">Placa de rodaje:</div>
                                    <div class="flex-1">
                                       <div class="input-group">
                                          <input type="text" class="form-control text-uppercase"
                                             (input)="changePlacaRodaje()" [maxlength]="maxLengthPlacaRodaje"
                                             formControlName="a_s3_PlacaRodajeFC" />
                                          <button class="btn btn-outline-secondary" *ngIf="tipoSolicitante !== 'PNR'"
                                             [disabled]="a_s3_PlacaRodajeFC.value.trim().length !== 6" type="button"
                                             (click)="buscarPlacaRodaje()">
                                             <i class="fas fa-search"></i>
                                          </button>
                                       </div>
                                    </div>
                                 </div>

                                 <div class="d-flex mt-3 align-items-center" *ngIf="tipoSolicitante !== 'PNR'">
                                    <div class="flex-1 campo-obligatorio">SOAT:</div>
                                    <div class="flex-2">
                                       <input type="text" class="form-control text-uppercase" disabled
                                          formControlName="a_s3_SoatFC" />
                                    </div>
                                 </div>
                              </div>
                              <div class="col-lg-5 flex-2 d-flex flex-column">
                                 <div class="d-flex align-items-center flex-1">
                                    <div class="flex-1">C.A.F</div>
                                    <div class="d-flex flex-2">
                                       <ui-switch (change)="onChangeCaf($event)" formControlName="a_s3_CafFC">
                                       </ui-switch>
                                       <button class="btn btn-danger btn-sm ms-3 align-self-center"
                                          *ngIf="visibleButtonCarf" (click)="inputFileCaf.click($event)">
                                          <i class="fas fa-upload"></i>
                                          Adjuntar C.A.F.
                                       </button>
                                       <input type="file" class="d-none" #inputFileCaf accept="application/pdf"
                                          (change)="onChangeInputCaf($event)" />
                                       <i class="far fa-file-pdf text-danger fa-2x ms-3" title="Vista previa"
                                          *ngIf="filePdfCafSeleccionado || filePdfCafPathName"
                                          (click)="vistaPreviaCaf()"></i>
                                    </div>
                                 </div>

                                 <div class="d-flex mt-3 align-items-center" *ngIf="tipoSolicitante !== 'PNR'">
                                    <div class="flex-1 campo-obligatorio">CITV:</div>
                                    <div class="flex-2">
                                       <!--<input type="text" class="form-control text-uppercase" disabled
                                                formControlName="a_s3_CitvFC" />-->
                                       <select class="form-select" formControlName="a_s3_CitvFC" disabled>
                                          <!--disabled-->
                                          <option *ngFor="let item of listaPlacaNumero; let i = index" [value]="item">{{
                                             item }}</option>
                                       </select>
                                    </div>
                                 </div>
                              </div>
                              <div class="col-lg-2 flex-1 d-flex flex-column align-self-end">
                                 <button class="btn btn-danger btn-sm flex-1" (click)="agregarFlotaVehicular()">
                                    <div *ngIf="indexEditTabla === -1; else elseBlock">
                                       <i class="fas fa-plus"></i>
                                       Agregar
                                    </div>
                                    <ng-template #elseBlock>
                                       <i class="fas fa-pencil-alt"></i>
                                       Modificar
                                    </ng-template>
                                 </button>

                                 <button *ngIf="indexEditTabla !== -1"
                                    class="btn btn-warning btn-sm mt-2 flex-1 anexo001-a17-btn-cancelar"
                                    (click)="cancelarFlotaVehicular()">
                                    Cancelar
                                 </button>
                              </div>
                           </div>

                           <div class="row mt-3">
                              <div class="col-lg-12">
                                 <div class="table-responsive">
                                    <table class="table table-bordered table-sm">
                                       <thead class="tabla-header-mtc">
                                          <tr>
                                             <th>N°</th>
                                             <th>Placa de rodaje</th>
                                             <th>SOAT</th>
                                             <th>CITV</th>
                                             <th>C.A.F.</th>
                                             <th>Acciones</th>
                                          </tr>
                                       </thead>
                                       <tbody *ngIf="listaFlotaVehicular.length > 0; else sinRegistros">
                                          <tr class="text-uppercase" [class.registro-edit]="indexEditTabla === i"
                                             *ngFor="let item of listaFlotaVehicular; let i = index">
                                             <td class="text-center">{{ i + 1 }}</td>
                                             <td>{{ item.placaRodaje }}</td>
                                             <td>{{ item.soat }}</td>
                                             <td>{{ item.citv }}</td>
                                             <td *ngIf="item.caf === false; else pdfcaf"></td>
                                             <ng-template #pdfcaf>
                                                <td class="text-center">
                                                   <i class="far fa-file-pdf" (click)="verPdfCafGrilla(item)"></i>
                                                </td>
                                             </ng-template>
                                             <td class="text-center">
                                                <i class="far fa-edit pe-2 text-primary cursor-pointer"
                                                   [class.opacity-icon]="indexEditTabla !== -1" title="Editar"
                                                   (click)="modificarFlotaVehicular(item, i)"></i>
                                                <i class="far fa-trash-alt ps-2 text-danger cursor-pointer"
                                                   [class.opacity-icon]="indexEditTabla !== -1" title="Eliminar"
                                                   (click)="eliminarFlotaVehicular(item, i)"></i>
                                             </td>
                                          </tr>
                                       </tbody>
                                       <ng-template #sinRegistros>
                                          <tbody>
                                             <tr>
                                                <td colspan="6" class="text-center">No se encontraron registros
                                                </td>
                                             </tr>
                                          </tbody>
                                       </ng-template>
                                    </table>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </ng-template>
                  </div>
               </div>
            </div>
         </div>
      </form>
   </div>
</div>

<div class="modal-footer anexo">
   <div class="row">
      <div class="col-lg-12 d-flex">
         <div class="flex-1">
            <div class="btn-group" role="group" aria-label="Basic example">
               <button type="button" class="btn btn-secondary" [disabled]="idAnexo === 0" (click)="descargarPdf()">
                  <i class="far fa-eye"></i>
                  Visualizar
               </button>
            </div>
         </div>
         <div class="flex-1 text-end">
            <button class="btn btn-success" (click)="guardarAnexo()" [disabled]="anexoFG.invalid">
               <i class="far fa-save"></i>
               {{
               (idAnexo === 0 ? 'Grabar' : 'Modificar')
               }}
            </button>
         </div>
      </div>
   </div>
</div>